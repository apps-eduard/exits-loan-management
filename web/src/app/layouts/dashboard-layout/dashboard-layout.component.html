<!-- Mobile backdrop -->
<div
  class="fixed inset-0 bg-gray-900 bg-opacity-50 z-20 md:hidden"
  [class.hidden]="!isSidebarOpen()"
  (click)="toggleSidebar()">
</div>

<!-- Sidebar -->
<aside
  class="fixed inset-y-0 left-0 w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col z-30 transform transition-transform duration-300 ease-in-out"
  [class.translate-x-0]="isSidebarOpen()"
  [class.-translate-x-full]="!isSidebarOpen()">

  <!-- Logo -->
  <div class="h-16 flex items-center px-6 border-b border-gray-200 dark:border-gray-700">
    <h1 class="text-lg font-bold text-primary-600 dark:text-primary-400">Pacifica Finance</h1>
  </div>

  <!-- RBAC Dynamic Navigation -->
  <div class="flex-1 overflow-y-auto">
    <app-dynamic-navigation></app-dynamic-navigation>
  </div>

  <!-- User Menu -->
  <div class="p-4 border-t border-gray-200 dark:border-gray-700">
    <div class="flex items-center justify-between">
      <div class="flex items-center min-w-0 flex-1">
        <div class="w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-600 dark:text-primary-400 font-bold flex-shrink-0">
          {{ getUserInitials() }}
        </div>
        <div class="ml-3 min-w-0 flex-1">
          <p class="text-sm font-medium text-gray-900 dark:text-white truncate">{{ user()?.firstName }} {{ user()?.lastName }}</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">{{ user()?.role }}</p>
        </div>
      </div>
    </div>
  </div>
</aside>

<!-- Main Content Area -->
<div
  class="min-h-screen flex flex-col transition-all duration-300 ease-in-out"
  [class.ml-64]="isSidebarOpen()"
  [class.ml-0]="!isSidebarOpen()">
  <!-- RBAC Role-Based Header -->
  <app-role-based-header (sidebarToggle)="toggleSidebar()"></app-role-based-header>

  <!-- Page Content -->
  <main class="flex-1 p-6 bg-gray-50 dark:bg-gray-900">
    <router-outlet></router-outlet>
  </main>
</div>
